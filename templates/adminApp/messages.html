{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Messages & Replies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            dark: '#0f172a',
                            light: '#f8fafc',
                            accent: '#334155'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="font-sans bg-gray-50 text-brand-dark antialiased min-h-screen flex flex-col">

    {% include 'Navbar/adminNavBar.html' %}

    <main class="flex-grow container mx-auto px-4 py-24 max-w-7xl">

        <div class="glass-card rounded-[2rem] p-8 mb-12">
            <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold mb-2">Message Center</h1>
                    <p class="text-gray-500">Monitor communications between Tenants and Owners</p>
                </div>
                <div class="mt-4 md:mt-0">
                    <span class="bg-blue-100 text-blue-800 text-xs font-medium px-3 py-1 rounded-full">
                        <i class="fas fa-shield-alt mr-1"></i> Admin View
                    </span>
                </div>
            </div>

            <!-- Messages Section -->
            <div class="mb-12">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <i class="fas fa-envelope-open-text text-gray-400"></i> All Messages
                </h2>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-gray-500 text-sm border-b border-gray-100">
                                <th class="p-4 font-medium">Tenant</th>
                                <th class="p-4 font-medium">Owner</th>
                                <th class="p-4 font-medium">Property</th>
                                <th class="p-4 font-medium w-1/3">Content</th>
                                <th class="p-4 font-medium">Timestamp</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            {% for message in messages %}
                            <tr class="hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0">
                                <td class="p-4 font-medium text-brand-dark">{{ message.tenant.username }}</td>
                                <td class="p-4 text-gray-600">{{ message.owner.username }}</td>
                                <td class="p-4 text-gray-600">{{ message.property.title }}</td>
                                <td class="p-4 text-gray-500 truncate max-w-xs" title="{{ message.content }}">
                                    {{ message.content }}
                                </td>
                                <td class="p-4 text-gray-400 text-xs">{{ message.timestamp }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="p-8 text-center text-gray-400">
                                    No messages found.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Replies Section -->
            <div>
                <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
                    <h2 class="text-xl font-bold flex items-center gap-2">
                        <i class="fas fa-reply-all text-gray-400"></i> Replies
                    </h2>

                    <form method="get" class="w-full md:w-auto">
                        <div class="relative">
                            <i class="fas fa-filter absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            <select name="owner_id" id="owner_id" onchange="this.form.submit()"
                                class="pl-10 pr-8 py-2 rounded-full bg-gray-100 border-transparent focus:bg-white focus:border-black focus:ring-0 text-sm w-full md:w-64 transition cursor-pointer appearance-none">
                                <option value="">Filter by Owner</option>
                                {% for owner in owners %}
                                <option value="{{ owner.id }}" {% if selected_owner and selected_owner.id == owner.id %}selected{% endif %}>
                                    {{ owner.username }}
                                </option>
                                {% endfor %}
                            </select>
                            <i
                                class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 text-xs pointer-events-none"></i>
                        </div>
                    </form>
                </div>

                {% if replies %}
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="text-gray-500 text-sm border-b border-gray-100">
                                <th class="p-4 font-medium w-1/4">Original Message</th>
                                <th class="p-4 font-medium">Sender (Owner)</th>
                                <th class="p-4 font-medium">Recipient (Tenant)</th>
                                <th class="p-4 font-medium w-1/3">Reply Content</th>
                                <th class="p-4 font-medium">Timestamp</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            {% for reply in replies %}
                            <tr class="hover:bg-gray-50 transition-colors border-b border-gray-50 last:border-0">
                                <td class="p-4 text-gray-500 truncate max-w-xs" title="{{ reply.message.content }}">
                                    {{ reply.message.content }}
                                </td>
                                <td class="p-4 font-medium text-brand-dark">
                                    {% if reply.owner %}{{ reply.owner.username }}{% else %}N/A{% endif %}
                                </td>
                                <td class="p-4 text-gray-600">
                                    {% if reply.tenant %}{{ reply.tenant.username }}{% else %}N/A{% endif %}
                                </td>
                                <td class="p-4 text-gray-600">
                                    {{ reply.content }}
                                </td>
                                <td class="p-4 text-gray-400 text-xs">{{ reply.timestamp }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="p-8 text-center text-gray-400">
                                    No replies found for this owner.
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-12 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
                    <i class="fas fa-filter text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500">Select an owner above to view their replies.</p>
                </div>
                {% endif %}
            </div>

        </div>
    </main>

</body>

</html>